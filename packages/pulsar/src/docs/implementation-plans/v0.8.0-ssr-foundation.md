# v0.8.0-alpha: SSR Foundation

**Target:** March-April 2026  
**Goal:** 95% feature parity with Solid.js (from 85%)  
**Duration:** 4-6 weeks

## Implementation Rules

**CRITICAL - Must Follow:**

- One item per file
- Prototype-based classes
- Feature slice architecture
- Separate server/client code
- No DOM APIs in server code
- All types in .types.ts files

## Features

### 1. renderToString() ðŸ”´ CRITICAL

**Priority:** P0  
**Duration:** 2 weeks

**File Structure:**

```
src/server/
â”œâ”€â”€ index.ts                    # Server exports
â”œâ”€â”€ render-to-string.ts         # Main sync SSR
â”œâ”€â”€ render-to-string.types.ts   # Types
â”œâ”€â”€ dom-builder/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ element-builder.ts      # HTML element generation
â”‚   â”œâ”€â”€ attribute-builder.ts    # Attribute serialization
â”‚   â””â”€â”€ escape-html.ts          # HTML escaping
â”œâ”€â”€ hydration/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ marker-generator.ts     # Hydration markers
â”‚   â””â”€â”€ marker.types.ts
â””â”€â”€ README.md
```

**Implementation:**

- Synchronous component rendering to HTML string
- No async operations
- Generate hydration markers
- Escape HTML content
- Serialize attributes
- Handle special cases (style, class, events)

**Acceptance Criteria:**

- [ ] Renders components to HTML
- [ ] Hydration markers present
- [ ] HTML properly escaped
- [ ] Attributes serialized correctly
- [ ] No DOM dependencies
- [ ] Tests pass (30+ cases)
- [ ] Benchmarks: <50ms for 1000 components

---

### 2. renderToStringAsync() ðŸ”´ CRITICAL

**Priority:** P0  
**Duration:** 1 week

**File Structure:**

```
src/server/async/
â”œâ”€â”€ index.ts
â”œâ”€â”€ render-to-string-async.ts   # Async SSR
â”œâ”€â”€ resource-resolver.ts        # Wait for resources
â”œâ”€â”€ suspense-collector.ts       # Collect suspense boundaries
â””â”€â”€ README.md
```

**Implementation:**

- Wait for all resources to resolve
- Handle Waiting/Suspense boundaries
- Collect resource promises
- Render with loaded data
- Timeout handling

**Acceptance Criteria:**

- [ ] Waits for resources
- [ ] Suspense boundaries resolved
- [ ] Timeout works (default 5s)
- [ ] Error handling correct
- [ ] Tests pass (20+ cases)
- [ ] Documentation complete

---

### 3. renderToStream() ðŸ”´ CRITICAL

**Priority:** P0  
**Duration:** 2 weeks

**File Structure:**

```
src/server/stream/
â”œâ”€â”€ index.ts
â”œâ”€â”€ render-to-stream.ts         # Streaming SSR
â”œâ”€â”€ stream-builder.ts           # Stream construction
â”œâ”€â”€ chunk-writer.ts             # Write HTML chunks
â”œâ”€â”€ suspense-stream.ts          # Out-of-order streaming
â””â”€â”€ README.md
```

**Implementation:**

- Progressive HTML rendering
- Stream chunks as ready
- Out-of-order Suspense support
- Backpressure handling
- Chunk boundary safety

**Acceptance Criteria:**

- [ ] Streams HTML progressively
- [ ] Suspense out-of-order works
- [ ] Backpressure handled
- [ ] Chunk boundaries safe
- [ ] Tests pass (25+ cases)
- [ ] Performance: TTFB <100ms

---

### 4. hydrate() ðŸ”´ CRITICAL

**Priority:** P0  
**Duration:** 1 week

**File Structure:**

```
src/client/
â”œâ”€â”€ index.ts
â”œâ”€â”€ hydrate.ts                  # Main hydration function
â”œâ”€â”€ hydrate.types.ts
â”œâ”€â”€ marker-parser.ts            # Parse hydration markers
â”œâ”€â”€ event-replay.ts             # Replay queued events
â”œâ”€â”€ mismatch-handler.ts         # Handle SSR mismatches
â””â”€â”€ README.md
```

**Implementation:**

- Attach to server-rendered DOM
- Parse hydration markers
- Replay queued events
- Detect/handle mismatches
- Progressive enhancement

**Acceptance Criteria:**

- [ ] Attaches to existing DOM
- [ ] Events work immediately
- [ ] Mismatches detected
- [ ] Progressive enhancement works
- [ ] Tests pass (20+ cases)
- [ ] TTI <200ms

---

## Structural Changes

### New Package Exports

```json
{
  "exports": {
    "./server": {
      "import": "./dist/server/index.js",
      "types": "./dist/server/index.d.ts"
    },
    "./client": {
      "import": "./dist/client/index.js",
      "types": "./dist/client/index.d.ts"
    }
  }
}
```

### Build Configuration

- Separate server/client builds
- Node.js polyfills for server
- Browser-only code eliminated in server build
- Server-only code eliminated in client build

### Environment Detection

```typescript
// src/env/is-server.ts
export const isServer = typeof window === 'undefined';
export const isClient = !isServer;
```

## Testing Strategy

**SSR Tests:**

- Render correctness
- Hydration marker accuracy
- Resource resolution
- Error handling

**Hydration Tests:**

- DOM attachment
- Event replay
- Mismatch recovery
- Progressive enhancement

**Integration Tests:**

- Full SSR â†’ hydration cycle
- Resource loading
- Suspense boundaries
- Real application scenarios

**Performance Tests:**

- renderToString: <50ms for 1000 components
- renderToStream: TTFB <100ms
- hydrate: TTI <200ms

## Migration Guide

**Breaking Changes:**

- `mount()` renamed to `render()` for clarity
- New `hydrate()` for SSR

**New APIs:**

- `renderToString()`
- `renderToStringAsync()`
- `renderToStream()`
- `hydrate()`

## Documentation

- [ ] SSR guide
- [ ] Hydration guide
- [ ] Deployment guide (Node, Edge, Cloudflare)
- [ ] Performance optimization
- [ ] Common pitfalls
- [ ] Framework comparison (Next.js, SolidStart)
